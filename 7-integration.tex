We finally have all the main ingredients to generalize our line integral detour and discuss integration of $n$-forms over $n$-dimensional manifolds.

\section{Orientation}

\newthought{We know from calculus one}, or our line integral examples, that the direction in which we traverse the interval, or a curve, can actually make a difference.
Indeed, the sign of the integral of a differential $n$-form is only fixed after choosing an orientation of the manifold.

If for a curve an orientation is simply a choice of a direction along it, so we can make sense of it in terms of clockwise or counter-clockwise, generalising the concept will require an extra abstraction step.
Not just that, you have seen already that in $\R^n$ there is a standard orientation, but in other vector spaces we may need to make arbitrary choices.
For manifolds, the situation is much more complicated: for example, on a M\"obius strip\footnote{Cf. Example~\ref{ex:mobius}.} it is impossible to make any such choice, as it turns out, it is non-orientable.

Let's get there step by step.

\begin{definition}
  Let $V$ be a one-dimensional vector space. Then $V\setminus\{0\}$ has two components.
  An \emph{orientation} of $V$ is a choice of one of these components, which one then labels as ``positive'' and ``negative''.
  A \emph{positive basis} of $V$ then is a choice of any non-zero vector belonging to the positive component, while a \emph{negative basis} of $V$ is a choice of any non-zero vector belonging to the negative component.
\end{definition}

\begin{example}
  The standard orientation of $\R$ is give by declaring that the positive numbers are the positive components of $\R\setminus\{0\}$.
  A common choice as positive basis for $\R$ is $\{e_1 \equiv 1\}$ while a negative basis could be $\{-e_1\}$.
\end{example}

Let $V$ be a $n$-dimensional vector space.
How can we generalize in a meaningful way the definition above?

By Proposition~\eqref{prop:dimLkV}, the space $\Lambda^n(V)$ is a one-dimensional vector space.
Moreover, if $\{e_1,\ldots,e_n\}$ is a basis for $V$, then $e_1\wedge\cdots\wedge e_n$ is a basis for $\Lambda^n(V)$.

Looks like we are getting somewhere.

\begin{definition}
  Let $V$ be a $n$-dimensional vector space.
  An \emph{orientation} on $V$ is a choice of orientation on $\Lambda^n(V)$.
  \marginnote{It should be clear from this that the orientation is, in fact, an equivalence class of ordered bases.}
  Therefore there are exactly two orientations: we say that a basis $\{e_1,\ldots,e_n\}$ of $V$ is \emph{positive} (or positively oriented) if $e_1\wedge\cdots\wedge e_n$ is a positive basis of $\Lambda^n(V)$ and \emph{negative} (or negatively oriented) otherwise.
\end{definition}

\begin{example}
  If $e_i$ is the standard $i$th basis vector in $\R^n$, the standard orientation of $\R^n$ is given by declaring that $e_1\wedge\cdots\wedge e_n$ is a positive basis of $\Lambda^n(\R^n)$ and thus that $\{e_1,\ldots,e_n\}$ is a positive basis of $\R^n$.
\end{example}

The key in the preservation of orientation now resides only in the way different bases are transformed by $n$-forms, as the following lemma shows.

\begin{lemma}\label{lemma:orient}
  Let $V$ be a $n$-dimensional vector space and let $0\neq \omega\in\Lambda^n(V)$.
  Then, all bases $\{v_1, \ldots, v_n\}$ for which $\omega(v_1,\ldots v_n) > 0$ give the same orientation for $V$.
\end{lemma}
\begin{proof}
  Let $\{v_1, \ldots, v_n\}$ and $\{w_1, \ldots, w_n\}$ denote two different basis for $V$, then there exists a linear isomorphism $\varphi$ such that $v = \varphi w$, that is $v_i = \varphi_{i}^j w_j$.
  By definition and by multilinearity we then have
  \begin{equation}\label{eq:posorie}
    \omega(v_1,\ldots v_n) = \omega(\varphi w_1,\ldots \varphi w_n) = \det(\varphi)\omega(w_1,\ldots w_n) > 0,
  \end{equation} that is the positivity of $\omega$ on the bases characterize the set of bases.
\end{proof}

\begin{exercise}
  Let $V$ be a $n$-dimensional vector space, prove that two nonzero $n$-forms on $V$ determine the same orientation if and only if each is a positive multiple of the other.
\end{exercise}

\begin{remark}
  Of course, if $V$ is a vector space, then an orientation on $V$ canonically determines an orientation on the dual space $V^*$ by declaring that the basis dual to a positive basis is itself positive.
\end{remark}

We are almost there.
The tangent space is a vector space and $n$-forms act naturally on tangent vectors, this seems likely to be the right place to define an orientation for a manifold, at least pointwise.
As usual, one does need to make sure that all the local orientations just defined on the tangent bundle are gluing together coherently.

\begin{remark}
  If we look at a single chart $(U,\varphi)$, by Lemma~\ref{lemma:orient} each chart in the atlas determines an orientation at each point of its domain, which will be positive if $\det(D\varphi)>0$ and negative otherwise.
  This procedure can be repeated for each chart in an atlas for $M$.
  Thus, in order to get a globally consistent ordering, we need to worry about the overlaps between charts.
\end{remark}

\begin{definition}
  We call an atlas $\cA = \{(U_i,\varphi_i)\}$ \emph{oriented} if all the charts have the same orientation, that is, if $\det(D\varphi_{ij}) > 0$ for all the transition functions $\varphi_{ij} := \varphi_i\circ\varphi_j^{-1}$.

  A manifold $M$ with an oriented atlas is called \emph{oriented manifold}.
  If an orientation exists, we say tht $M$ is \emph{orientable}, in this case we call the equivalence class of atlases with the same orientation an \emph{orientation}.
  Otherwise we say that the manifold is \emph{nonorientable}.
\end{definition}

An immediate consequence of Lemma~\ref{lemma:orient} is that if a manifold is orientable, there are exactly two different orientations.

\begin{definition}
  Given an orientation on a manifold, we say that any chart from the same equivalence class of atlases is \emph{positively oriented}, while we call all other charts \emph{negatively oriented}.
\end{definition}

If $M$ is connected, as for vector spaces, an orientation on $\Lambda^n(M)$ determines the orientation of the manifold.
\marginnote{If it is not connected, then we need to deal with each connected component separately.}

\begin{theorem}
  Let $M$ be a $n$-dimensional smooth manifold.
  A nowhere-vanishing $n$-form $\omega\in\Omega^n(M)$ uniquely determines an orientation.
  For this reason, nowhere vanishing $n$-forms on a smooth $n$-manifold are called \emph{volume forms}.
\end{theorem}
\begin{proof}
  Let $\varphi$ and $\psi$ be two different charts with overlapping domains (otherwise there is nothing to check) and with local coordinates $(x^i)$ and $(y^i)$ respectively.
  Define the transition map $\varphi := \psi\circ\varphi^{-1}$, so that $(y^1,\ldots,y^n) = \varphi(x)$.
  Since $d y^j = (D\varphi)_i^j dx^i$, we have that locally
  \begin{align}
    \omega &= \widetilde \omega (y) dy^1\wedge\cdots\wedge dy^n \\
    &= (\widetilde\omega \circ \varphi)(x) \det(\varphi|_x) dx^{1}\wedge\cdots\wedge dx^{n} \\
    &= \omega(x) dx^{1}\wedge\cdots\wedge dx^{n},
  \end{align}
  where we used Proposition~\ref{prop:wedgeToJDet} and Theorem~\ref{thm:pullbacksdifferentialforms}.
  Thus, $\omega(x)$ and $\widetilde\omega(y)$ have the same sign if and only if $\det(D\varphi|_x) > 0$.
\end{proof}

\begin{definition}
  Let $M$ be a $n$-dimensional smooth manifold.
  If $(U,\varphi)$ is a chart with local coordinates $(x^i)$ such that, in the coordinate representation, $\omega = \omega(x) dx^1\wedge\cdots\wedge dx^n$ with $\omega(x) > 0$, then we say that the chart $\varphi$ is \emph{positively oriented} with respect to $\omega$, otherwise we say that it is \emph{negatively oriented}.  
\end{definition}

\begin{remark}
  In fact, this definition can be immediately extended to vector bundles.
  Given a real vector bundle $\pi: E \to M$, an orientation of $E$ means that for each fiber $E_p$, there is an orientation of the vector space $E_p$ such that each trivialization map
  \begin{equation}
    \varphi_{U}:\pi^{-1}(U)\to U\times \R^{n},
  \end{equation}
  with $\R^n$ equipped with its standard orientation, is fiberwise orientation-preserving.
  \marginnote[-2em]{Otherwise said, we can cover the manifold by (continuous) local frames whose local trivializations are orientation preserving.}

  With this definition, the orientability of $M$ coincides with the orientability of the bundle $M\to TM$.
\end{remark}

\begin{example}
  The euclidean space $\R^n$ is orientable with orientation given by the continuous global frame $\frac{\partial}{\partial r^i},\ldots,\frac{\partial}{\partial r^n}$.
\end{example}

\begin{example}\label{exe:orientsphere}
  Let $M = \bS^1\subset \R^2$.
  This is an orientable manifold and we can find an orientation using the stereographic projections from Exercise~\ref{ex:stereo}.
  Let $U_1 = \bS^1\setminus\{N\}$ and $U_2 = \bS^1\setminus\{S\}$, with the associated diffeomorphisms
  \begin{equation}
    \varphi_1(p) = \frac{2p^1}{1-p^2}
    \quad\mbox{and}\quad
    \varphi_2(p) = \frac{2p^1}{1+p^2}.
  \end{equation}
  Let's pick a pointwise orientation by choosing as basis $X_p\in T_pM$ given by $X_p = -p^2 \frac{\partial}{\partial p^1} + p^1 \frac{\partial}{\partial p^2}$.
  Then, on $U_1$,
  \begin{align}
    (\varphi_1)_*(X) &= (d\varphi_1)_p(X) \\
    &= \left(\begin{smallmatrix}
      \frac{2}{1-p^2} & \frac{2p^1}{(1-p^2)^2}
    \end{smallmatrix}\right)
    \left(\begin{smallmatrix}
      -p^2 \\ p^1
    \end{smallmatrix}\right) \frac{\partial}{\partial x}\Big|_{\varphi_1(p)}\\
    &= \frac{2}{1-p^2} \frac{\partial}{\partial x}\Big|_{\varphi_1(p)},
  \end{align}
  and $\frac{2}{1-p^2}>0$.
  If we perform the same computation on $U_2$, however, we obtain $(\varphi_2)_*(X) = -\frac{2}{1+p^2}\frac{\partial}{\partial x}\Big|_{\varphi_2(p)}$, with the negative coefficient $-\frac{2}{1+p^2} < 0$ (check!), corresponding to the opposite orientation on $U_2$.
  Of course, in this case, not all is lost: by choosing $\widetilde\varphi_2(p) = \varphi_2(-p^1, p^2)$ we obtain $(\widetilde\varphi_2)_*(X) = \frac{2}{1+p^2} \frac{\partial}{\partial x}\Big|_{\widetilde\varphi_2(p)}$ with the positive coefficient $\frac{2}{1+p^2} > 0$ (check!), which shows that $X_p$ defines an orientation on the whole $\bS^1$.
\end{example}

\begin{exercise}
  Check that the Jacobian determinant $\det(D(\varphi_2\circ \varphi_1^{-1}))$ of the transition chart from Exercise~\ref{exe:orientsphere} is negative, while $\det(D(\widetilde\varphi_2\circ \varphi_1^{-1}))$ is positive.
\end{exercise}

\begin{marginfigure}
  \includegraphics{7_1-mobius_strip.pdf}
\end{marginfigure}

\begin{exercise}
  Consider the open M\"obius strip $M$, a variation of Example~\ref{ex:mobius} defined as the quotient of $\R\times(-1,1)$ via the identification $(x,y) \sim (x+1, -y)$, and denote $\pi: \R\times(-1,1)\to M$ the corresponding projection map.
  The M\"obius strip inherits the differentiable structure from $\R^2$, so we need to show that there is no orientable atlas which is also compatible with the differentiable structure on $M$.
  \begin{enumerate}
    \item Define the map $\sigma:\R\times(-1,1)\to\R\times(-1,1)$ by $\sigma(x,y) = (x+1, -y)$ and show that $\pi\circ\sigma = \sigma$.
    \item If $\nu\in\Omega^2(M)$ define $f$ by $\pi^* \nu = f \omega$ where $\omega$ is an area\footnote{I.e. a volume $2$-form.} form on $\R\times(-1,1)$.
    Show that $f(x+1, y) = - f(x,y)$.
    \item Conclude that $f$ must vanish at some point of $\R\times(-1,1)$, which implies that $M$ is nonorientable.
  \end{enumerate}
\end{exercise}

\begin{exercise}
  Let $f\in C^\infty(\R^{n+1})$ with $0$ as a regular value.
  Show that $f^{-1}(0)$ is an orientable submanifold of $\R^{n+1}$.
  %In particular, the unit $n$-sphere $\bS^n\subset\R^{n+1}$ is orientable.
\end{exercise}

\begin{exercise}[\textit{[homework 4]}]
  Let $M$ be a smooth manifold without boundary and $\pi: TM \to M$ its tangent bundle.
  Show that if $\{U,\phi\}$ is any atlas on $M$, then the corresponding\footnote{Remember Theorem~\ref{thm:tgbdlsmoothmfld}.} atlas on $TU$ is oriented.
  This, in particular, proves that the total space $TM$ of the tangent bundle is always orientable, regardless of the orientability of $M$.
\end{exercise}

\newthought{What about orientation on the boundaries?}
Let's first look at the tangent space. 

Let $M$ be a smooth $n$-manifold with boundary and $p\in \partial M$.
Then, we have three types of possible vectors:
\begin{enumerate}
  \item tangent boundary vectors: $X\in T_p(\partial M)\subset T_p M$ tangent to the boundary, forming an $(n-1)$-dimensional subspace of $T_p M$;
  \item inward pointing vectors: $X\in T_pM$ such that $X = \varphi^{-1}_*(Y)$ where $\varphi^{-1}: V\subset \cH^n \to M$ and $Y$ is some vector $Y = (Y^1, \ldots, Y_n)$ with $Y_n > 0$;
  \item outward pointing vectors: $X\in T_pM$ such that $-X$ is inward pointing.
\end{enumerate}
Thus, a vector field along $\partial M$ is a function $X:\partial M\to T_pM$ (not to $T_p\partial M$).

\begin{proposition}
  On a smooth manifold $M$ with boundary, there is a smooth outward pointing vector field along $\partial M$.  
\end{proposition}
\begin{proof}
  Pick an open cover of $\partial M$ with coordinate charts $\{(U_\alpha, (x^1_\alpha,\ldots,x^n_\alpha) \mid \alpha\in I\}$. Then $X_\alpha = -\frac{\partial}{\partial x^n_\alpha}$ on $U_\alpha\cap \partial M$ is smooth and outward pointing.
  Choose a partition of unity $\{\rho_\alpha \mid \alpha\in I\}$ on $\partial M$ subordinate to the open cover $\{U_\alpha\cap \partial M \mid \alpha\in I\}$.
  Then $X:= \sum_{\alpha\in I}\rho_\alpha U_\alpha$ is a smooth ouwtard pointing vector field along $\partial M$.
\end{proof}

We can use this to introduce a notion of induced orientation on $\partial M$.

\begin{proposition}
  Let $M$ be an oriented $n$-manifold with boundary.
  If $\omega$ is a volume form on $M$ and $X$ a smooth outward-pointing vector field on $\partial M$, then $\iota_X\omega$ is a smooth nowhere-vanishing $(n-1)$-form on $\partial M$ and, thus, $M$ is orientable.
\end{proposition}
\begin{proof}
  Since both $\omega$ and $X$ are smooth, the contraction $\iota_X\omega$ is also smooth.
  We need to check that it cannot vanish.

  Assume that $\iota_X\omega$ does vanish at some point $p\in\partial M$, that is, $(\iota_X)(v_1, \ldots, v_{n-1}) = 0$ for all $v_1, \ldots, v_{n-1}\in T_p(\partial M)$.
  Let $\{e_1,\ldots,e_{n-1}\}$ be a basis for $T_p(\partial M)$.
  Then $\{X_p,e_1,\ldots,e_{n-1}\}$ is a basis for $T_p M$ such that
  \begin{equation}
    \omega_p(X_p, e_1, \ldots, e_{n-1}) = (\iota_X\omega)_p(e_1, \ldots, e_{n-1}) = 0.
  \end{equation}
  Then, by Exercise~\ref{ex:zeroform}, $\omega_p\equiv0$ reaching a contradiction.
  
  Therefore, $\iota_X\omega$ is non-vanishing on $\partial M$ which means that $\partial M$ is orientable.
\end{proof}

\begin{exercise}
  Let $M$ be an oriented manifold with boundary, $\omega$ an orientation for $M$ and $X$ a smooth outward pointing vector field along $\partial M$.
  Prove the following statements.
  \begin{enumerate}
    \item It $\sigma$ is another orientation form on $M$, then $\sigma = f\omega$ for some everywhere positive $f\in C^\infty(M)$. Prove that  $\iota_X\sigma = f\iota_X \omega$ on $\partial M$.
    \item Show that if $Y$ is another smooth outward pointing vector field along $\partial M$, then there is an everywhere positive $f\in C^\infty(M)$ such that $\iota_Y\sigma = f \iota_X \omega$ on $\partial M$.
  \end{enumerate}
\end{exercise}

Note that if $(U_i, \varphi_i)$ is a positively oriented atlas on $M$, then $(U_i|_{\partial M}, \varphi_i|_{\partial M})$ can be negatively oriented. 
Let $\omega = dx^1\wedge\cdots\wedge dx^n$ be a positive volume form on $M$ on one of the charts, then $-\frac{\partial}{\partial x^n}$ is an outward pointing on $\partial \cH^n$ and we have
\begin{align}
  \iota_{-{\partial}/\!{\partial x^n}} (dx^1\wedge\cdots\wedge dx^n)
  &= -\iota_{{\partial}/\!{\partial x^n}} (dx^1\wedge\cdots\wedge dx^n) \\
  &= -(-1)^{n-1} dx^1\wedge\cdots\wedge dx^{n-1}\wedge \iota_{{\partial}/\!{\partial x^n}} (dx^n) \\
  &= (-1)^n dx^1\wedge\cdots\wedge dx^{n-1}.
\end{align}
Thus, for example, the boundary orientation on $\partial \cH^1 = \{0\}$ is $-1$, the one on $\partial \cH^2$ is the standard orientation on $\R$ given by $dx^1$ and the one on $\partial \cH^3$ is $-dx^1\wedge dx^2$, which is the clockwise orientation in the $(x^1, x^2)$-plane, etc.

\begin{example}\label{ex:int:bdryo}
  The closed interval $[a,b]\subset\R$ with standard euclidean coordinate $x$ has a standard orientation given by the vector field $\frac{\partial}{\partial x}$. 
  Therefore, the boundary orientation at $b$ is $\iota_{\frac{\partial}{\partial x}}(dx) = +1$ and the one at $a$ is $\iota_{-\frac{\partial}{\partial x}}(dx) = -1$.
\end{example}

\begin{exercise}
  \begin{enumerate}
    \item Prove that $\bS^n$ is orientable.
    \item Prove that any Lie group is orientable.
    \item Prove that $\RP^n$ is orientable if and only if $n$ is odd. \\
      \textit{\small Hint: the antipodal map $x\mapsto -x$ on $\bS^n$ can help.}
  \end{enumerate}
\end{exercise}

\section{Integrals on manifolds}

To avoid unnecessary complications, we will only integrate $n$-forms with compact support.
Armed with our experience with line integrals, fond memories of multivariable analysis and our recent discoveries, we are finally ready to talk about integrals.
Let's keep things simple and go one step at a time.

\begin{definition}\label{def:intnform:chart}
  Let $M$ be a smooth $n$-manifold and $(U,\varphi)$ be a chart from an oriented atlas of $M$.
  If $\omega\in\Omega^n(M)$ be a $n$-form with compact support in $U$, we define the integral of $\omega$ as
  \begin{equation}
    \int_M \omega = \int_U \omega := \int_{\varphi(U)} \varphi_*\omega := \int_{\cH^n} \omega(p) d^n p,
  \end{equation}
  where $d^n p$ denotes the $n$-dimensional Lebesgue measure on $\R^n$ and on the chart
  \begin{equation}
    \varphi_*\omega = \omega(p) e^1\wedge \cdots\wedge e^n\in\Omega^n(\cH^n).
  \end{equation}

  If $M$ is an oriented $0$-dimensional manifold and $f$ is a $0$-form (that is, a smooth function) than we defined the integral to be the sum
  \begin{equation}
    \int_M f = \sum_{p\in M} \pm f(p),
  \end{equation}
  where we take the positive sign at points where the orientation is positive and the negative sign at points where it is negative.
  The compactness assumption here implies that there are only finitely many nonzero terms in the sum.
\end{definition}

To make sure that this definition makes sense, let's show that the integral is well-defined, that is, up to orientation it does not depend on the chosen chart.

\begin{lemma}\label{lemma:intindep:chart}
  Suppose $\omega\in\Omega^n(M)$ with compact support $\supp \omega \subset U\cap V$, where $(U, \varphi)$ and $(V, \psi)$ are two positively oriented charts on the oriented manifold $M$.
  Then, the value of the integral $\int_M\omega$ is independent on the chosen chart.
\end{lemma}
\begin{proof}
  Let $\varphi$ and $\psi$ be two charts on $U$ with the same orientation and local coordinates $p$ and $q$, let $\varphi = \psi\circ\varphi^{-1}$ be the corresponding transition map.
  Then,
  \begin{align}
    \int_{\varphi(U)} \varphi_*\omega &= \int \omega(p)\, d^n p \\
    &\overset{(\bigstar)}{=} \int (\widetilde\omega \circ \varphi)(p) \det(D\varphi|_p) d^n p \\
    &\overset{(\clubsuit)}{=} \int \widetilde\omega(q) d^n q\\
    &= \int_{\psi(U)} \psi_*\omega,
  \end{align}
  where $\omega(p)$ and $\widetilde\omega(q)$ are the local expressions for $\omega$ in the two coordinate charts, in $(\bigstar)$ we applied Proposition~\ref{prop:wedgeToJDet} and in $(\clubsuit)$ we used the classical euclidean change of variables.
\end{proof}

To be able to integrate charts which are not supported in the domain of a single chart, we now need the help of a partition of unity.

\begin{definition}
  Let $M$ be a smooth oriented manifold and $\cA = \{(U_i,\varphi_i)\}$ a positively oriented atlas.
  If $\omega \in \Omega^n(M)$ has compact support, then the \emph{integral of $\omega$} is defined as
  \begin{equation}\label{eq:intnform}
    \int_M \omega := \sum_{j=1}^N \int_{U_j}\rho_j\omega,
  \end{equation}
  where $\{\rho_j\mid j=1,\ldots, N\}$ is a partition of unity subordinate to a finite cover of $\supp \omega$ by charts $\{U_j\}$ and such that $\sum_{j=1}^N \rho_j(p) = 1$ for $p\in\supp\omega$.
  \marginnote{The terms on the right hand side of \eqref{eq:intnform} are all integrals as in Definition~\ref{def:intnform:chart}.}
\end{definition}

The definition above makes sense only if the value of the integral is independent of the chosen partition, but with the help of the previous lemma this is easily checked.

\begin{lemma}\label{lemma:intinman}
  The value of $\int_M\omega$ is independent from the choice of the atlas and the choice of partition of unity.
\end{lemma}
\begin{proof}
  The independence from the choice of the charts was demonstrated in Lemma~\ref{lemma:intindep:chart}.
  Let $\{\widetilde\rho_j\}$ be another partition of unity adapted to a (possibly different) finite cover by charts $\{(V_j, psi_j)\}$ with $\sum \widetilde\rho_j(p) = 1$ for $p\in\supp\omega$.
  Then we have,
  \begin{align}
    \sum_j \int_{\varphi_j(U_j)} (\varphi_j)_*\left(\rho_j \omega\right)
    &= \sum_j \int_{\varphi_j(U_j)} (\varphi_j)_*\left(\rho_j \sum_k \widetilde\rho_k\omega\right) \\
    &= \sum_{j,k} \int_{\phi_j(U_j\cap V_k)} (\varphi_j)_* \left(\rho_j \widetilde\rho_k\omega\right) \\
    &\overset{(\spadesuit)}{=} \sum_{j,k} \int_{\psi_k(U_j\cap V_k)} (\psi_k)_* \left(\rho_j \widetilde\rho_k\omega\right) \\
    &= \sum_k \int_{\psi_k(U_j\cap V_k)} (\psi_k)_*\left(\rho_j \widetilde\rho_k \sum_j\rho_j \omega\right) \\
    &= \sum_k \int_{\psi_k(V_k)} (\psi_k)_*\left( \widetilde\rho_k \omega\right),
  \end{align}
  where in $(\spadesuit)$ we used Lemma~\ref{lemma:intindep:chart}.
\end{proof}

This result can be nicely formalized as follows.
\begin{theorem}[Global change of variable]
  Suppose $M$ and $N$ are oriented $n$-manifolds and $F:M\to N$ is an orientation preserving diffeomorphism.
  If $\omega\in\Omega^n(N)$ has compact support, then $F^*\omega$ has compact support and the following holds
  \begin{equation}
    \int_N \omega = \int_M F^* \omega.
  \end{equation}
\end{theorem}
\begin{proof}
  First of all, observe that $\supp(F^*\omega) = F^{-1}(\supp(\omega))$ which is compact since manifolds are Hausdorff spaces and $F$ is continuous.

  Let now $\{(U_i,\varphi_i)\}$ be an atlas of a positively oriented chart on $M$ and $\{\rho_i\}$ a subordinate partition of unity.
  Then, $\{(F(U_i),\varphi_i\circ F^{-1})\}$ is an atlas of positively oriented charts for $N$ and $\{\rho_i \circ F^{-1}\}$ is a partition of unity subordinate to the covering $\{(F(U_i)\}$.
  By Lemma~\ref{lemma:intinman} we have,
  \begin{align}
    \int_M F^*\omega &= \sum_i \int_M \rho_i F^*\omega \\
    &= \sum_i \int_{\R^n}(\varphi_i)_*(\rho_i F^*\omega)\\
    &= \sum_i \int_{\R^n}(\varphi_i)_*(F^{-1})_*(\rho_i \circ F^{-1}) \omega \\
    &= \sum_i \int_{\R^n}(\varphi_i \circ F^{-1})_*(\rho_i \circ F^{-1}) \omega \\
    &= \int_N\omega,
  \end{align}
  which shows the commutativity of the following diagram
  \begin{equation}
    \begin{tikzcd}
      \Omega^n(M) \arrow[rr, "F^*", yshift=0.5ex] \arrow[dr, "\int_M"] & & \Omega^n(N)\arrow[ll, "F_*", yshift=0.5ex] \arrow[dl, "\int_N"] \\
      & \R &
    \end{tikzcd}
  \end{equation}
  and concludes the proof.
\end{proof}

This justifies the following definition.

\begin{definition}[Integral on submanifolds]\label{def:insm}
  Let $M$ a smooth $m$-manifold, $N$ an oriented smooth $n$-manifold and $J:N\to M$ a smooth map\footnote{If $N\subset M$ is a submanifold, then $J:N\hookrightarrow M$ is just the inclusion map.}.
  If $\omega\in\Omega^m(M)$ has compact support, we define
  \begin{equation}
    \int_N \omega := \int_N J^*\omega.
  \end{equation}
  In particular, if $M$ is compact, oriented, smooth $m$-manifold, $\omega$ is a $(m-1)$-form on $M$ and $i:\partial M\hookrightarrow M$ is the inclusion of the boundary in $M$, we can interpret unambiguously
  \begin{equation}
    \int_{\partial M} \omega := \int_{\partial M} i^* \omega,
  \end{equation}
  where $partial M$ is understood to have the induced orientation.
\end{definition}

\begin{example}\label{ex:intint}
  Let $M=[a,b]\subset \R$ equipped with the canonical global atlas $\{(M, \id_\R|_M)\}$ and $f\in C^\infty_0(M)$, i.e., smooth with compact support\footnote{Which does not mean $f(a) = f(b)=0$ since $[a,b]$ is itself compact.}.
  Then, $df\in\Omega^1(M)$ and $\supp df \subset \supp f$ is compact as well and we have
  \begin{equation}
    \int_M df = \int_a^b \frac{\partial f}{\partial x} dx = f(b)- f(a) = \int_{\partial M} f.
  \end{equation}
\end{example}

\begin{exercise}[Fubini's theorem \textit{[homework 4]}]\label{exe:fubini}
  Let $M^m$ and $N^n$ be oriented manifolds. Endow $M\times N$ with the product orientation, that is\footnote{An equivalent way is to say that if $v_1,\ldots,v_m\in T_pM$ and $w_1, \ldots, w_n\in T_q N$ are positively oriented bases in the respective spaces, then \begin{equation}
    (v_1,0),\ldots,(v_n,0),(0,w_1), \ldots, (0,w_n)\in T_{(p,q)}M\times N
  \end{equation}is defined to be a positively oriented basis in the product.}, if $\pi_M : M\times N to M$ and $\pi_N: M\times N \to N$ are the canonical projections on the elements of the product, and $\omega$ and $\eta$ respectively define orientations on $M$ and $N$, then the orientation on $M\times N$ is defined to be the orientation defined by $\pi_M^* \omega \wedge \pi_N^* \eta$.

  If $\alpha\in\Omega^m(M)$ and $\beta\in\Omega^n(N)$ have compact support, show that
  \begin{equation}
    \alpha\times\beta := (\pi_M^*\alpha)\wedge(\pi_N^*\beta)
  \end{equation}
  has compact support and is a $(m+n)$-form on $M\times N$.
  Then, prove Fubini's theorem:
  \begin{equation}
    \int_{M\times N}\alpha\times\beta = \left(\int_M\alpha\right)\left(\int_N\beta\right).
  \end{equation}
\end{exercise}

\begin{exercise}
  Let $\{e_1,\ldots,e_{n+1}\}$ be the standard basis of $\R^{n+1}$ and $\Omega_{n+1} := e_1\wedge\cdots\wedge e_{n+1}$ the induced volume form.
  On $\bS^n$ define $\omega_n\in\Omega^n(\bS^n)$ by
  \begin{equation}
    \omega_n(s)(v_1, \ldots, v_n) = \Omega_{n+1}(s, v_1, \ldots, v_n)
  \end{equation}
  for $s\in\bS^n$ and $v_1,\ldots,v_n\in T_s\bS^n$.

  In this exercise we are going to define a canonical volume $\omega_n$ on $\bS^n$ and prove that 
  \begin{equation}
    \int_{\bS^n} \omega_n = \frac{2^{m+1}\pi^n}{(2m-1)!}, \quad\mbox{if } n=2m,\; m\geq 1,
  \end{equation}
  and
  \begin{equation}
    \int_{\bS^n} \omega_n = \frac{2\pi^{m+1}}{m!}, \quad\mbox{if } n=2m+1,\; m\geq 0.
  \end{equation}

  \begin{enumerate}
    \item Show that $\omega_n$ is a volume form on $\bS^n$. In fact it is the so-called standard volume form on $\bS^n$.
    \item Let $f:\R_+\times\R^{n+1}\setminus\{0\}\to \R^{n+1}\setminus\{0\}$ be given by $f(t,s) = ts$, where $\R_+$ is defined to be the set $\{t\in\R \mid t >0\}$.
    Show that if $\R_+$ is oriented by $dt$, $\bS^n$ is oriented by $\omega_n$ and $\R^{n+1}$ is oriented by $\Omega_{n+1}$, then the Jacobian determinant $\det(Df(t,s))= t^n$.
    Conclude that $f$ is orientation preserving.
    \item Let $M$ be the annulus $M = \{x\in\R^{n+1} \mid 0<a<\|x\|<b<\infty\}$. Consider the restriction $f|_{(a,b)\times \bS^n}$ and show that for $x\in\R^{n+1}$,
    \begin{equation}
      f^*\left(e^{-\|x\|^2}\Omega_{n+1}\right) = t^n e^{-t^2}(dt \times \omega_n),
    \end{equation}
    where $dt\times\omega_n$ is a product volume form as in Exercise~\ref{exe:fubini}.
    \item Show that
    \begin{equation}
      \int_{\R^{n+1}}e^{-\|x\|^2}\Omega_{n+1} = \int_a^b t^ne^{-t^2} dt \int_{\bS^n}\omega_n.
    \end{equation}
    \item Consider the limits $a\to0^+$ and $b\to+\infty$ and show that
    \begin{equation}
      \int_0^\infty t^n e^{-t^2} dt \int_{\bS^n}\omega_n = \left(\int_{-\infty}^{+\infty} e^{-u^2} du\right)^{n+1}.
    \end{equation}
    \item Assume to know that $\int_{-\infty}^{\infty} e^{-u^2}du = \sqrt{\pi}$. Show that
    \begin{equation}
      \int_0^\infty t^{2m} e^{-t^2}dt = \frac{(2m-1)!!\sqrt{\pi}}{2^{m+1}}
      \quad\mbox{and}\quad
      \int_0^\infty t^{2m+1} e^{-t^2}dt = \frac{m!}{2},
    \end{equation}
    and use them to deduce the required formulas for $\int_{\bS^n}\omega_n$.
  \end{enumerate}
\end{exercise}

\begin{remark}
  The integral defined in this section can be extended rather immediately to measurable functions.
  Let $\omega\in\Omega^n(M)$ be a positive volume form and let $f:M\to[0,\infty)$ be measurable.
  Then one can define
  \begin{align}
    \int_M f \omega
    &= \sum_i \int_{\varphi_i(U_i)} (\varphi_i)_*(\rho_i f\omega) \\
    &= \sum_i \int_{\varphi_i(U_i)} (\rho_i f \circ\varphi_i^{-1}) (\varphi_i)_*\omega \\
    &= \sum_i \int_{\varphi_i(U_i)} (\rho_i f \circ\varphi_i^{-1})(x) \omega(x) d^n x,
  \end{align}
  where the last integral is a Lebesgue integral on $\R^n$.
  One then calls $f:M\to \R$ integrable, saying $f\in L^1(M,\omega)$, if $\int_M|f|\omega < \infty$ and defines its integral as $\int_M f\omega := \int_M f^+\omega - \int_M f^-\omega$, where $f^\pm$ denote the positive and negative components of $f$ as in the euclidean case.
\end{remark}

\section{Stokes' Theorem}

Stokes' theorem states that if $\omega$ is an $(n-1)$-form on an orientable $n$-manifold $M$, then the integral of $d\omega$ over $M$ equals the integral of $\omega$ over $\partial M$, generalising our observations for the line integral.
This is a beautiful and very important results, with deep consequences. The most immediate ones are the classical theorems of Gauss, Green and Stokes, which are just a special cases of this result.

We are going to state the theorem, discuss some of its consequences and then give its proof.

\begin{theorem}\label{thm:Stokes}
  Let $M$ be an oriented $n$-manifold with boundary and let $\omega\in\Omega^{n-1}(M)$ be compactly supported.
  Then,
  \begin{equation}\label{eq:Stokes}
    \int_M d\omega = \int_{\partial M} \omega.
  \end{equation}
  \marginnote{Here, $\partial M$ inherits the orientation from $M$ as in Definition~\ref{def:insm}, $\omega$ on the right-hand side is interpreted as $i^*\omega$ where $i:\partial M \hookrightarrow M$ is the inclusion of the boundary and if $\partial M =\emptyset$ then the right-hand side is interpreted as $0$.}
\end{theorem}

\marginnote{On a similar note, the fact that $dd\omega =0$ for every $\omega\in\Lambda^n(M)$ corresponds to the fact that a boundary has no boundary, that is $\partial\partial M = \emptyset$ for any $M$: indeed, for any $\omega\in\Lambda^n(M)$ one has \begin{equation}
  0=\int_M dd\omega = \int_{\partial M}d\omega = \int_{\partial\partial M} \omega.
\end{equation}}
\begin{corollary}
  Let $M$ be an oriented $n$-manifold without boundary and let $\omega\in\Omega^{n-1}(M)$ be compactly supported.
  Then,
  \begin{equation}
    \int_M d\omega = 0.
  \end{equation}
  That is, the integral of a compactly supported exact form over a manifold without boundary vanishes.
\end{corollary}

\begin{corollary}
  Let $M$ be a compact oriented $n$-manifold with boundary and let $\omega\in\Omega^{n-1}(M)$ be closed.
  Then,
  \begin{equation}
    \int_{\partial M} \omega = 0.
  \end{equation}
  That is, the integral of a closed form on the boundary of a compact manifold vanishes.
\end{corollary}

\begin{corollary}[Green's theorem]
  Suppose $D$ is a compact regular domain in $\R^2$ and $P,Q\in C^\infty(D)$, then
  \begin{equation}
    \int_D \left(\frac{\partial Q}{\partial x} - \frac{\partial P}{\partial x}\right)dxdy = \int_{\partial D}(Pdx + Qdy).
  \end{equation}
\end{corollary}

\begin{corollary}
  Let $M$ a smooth $m$-manifold, $N$ an oriented submanifold of dimension $n$. Let $J:N\to M$ be a smooth map\footnote{If $N\subset M$ is a submanifold, then $J:N\hookrightarrow M$ is just the inclusion map.}.
  If $\omega\in\Omega^{n-1}(M)$ has compact support, we define
  \begin{equation}
    \int_N d\omega = \int_{\partial N} \omega,
  \end{equation}
  where $\partial N$ inherits the orientation from $N$.
\end{corollary}

\begin{remark}
  The requirement of compactness in Stokes' theorem may seem there just to avoid technicalities involving the convergence of the integral, however, it also avoid subtleties due to the boundary as shown in the following example.
  Let $M=(a,b)$, thus $\partial M = \emptyset$, and $f(x)=x$.
  Then.
  \begin{equation}
    b-a = \int_a^b df \neq \int_{\partial M} f = 0.
  \end{equation}
  But this does not contradict Stokes' theorem since $f$ is not compactly supported.

  If you close the interval, then $f$ becomes with compact support and we are back in the case of Example~\ref{ex:intint} where we had already seen Stokes' theorem.
\end{remark}

\begin{proof}
  \newthought{Part I: euclidean boundary case}.
  Let's start with a special case: suppose $M = \cH^n$ itself.
  Since $\omega$ has compact support, there is $R > 0$ such that $\supp \omega \subset A = [-R,R]^{n-1}\times[0,R]$ is enclosed within the rectangle $A$.
  We can write $\omega$ in standard coordinates to get
  \begin{equation}
    \omega = \sum_{j=1}^n \omega^j dx^1 \wedge \cdots\wedge \widehat{dx}^j \wedge \cdots\wedge dx^n
  \end{equation}
  where the hat means that the corresponding element $dx^j$ is omitted.
  Therefore\footnote{Exercise: explicitly write down the steps of the computation.},
  \begin{equation}
    d\omega = \sum_{j=1}^n (-1)^{j-1} \frac{\partial \omega^j}{\partial x^j}dx^1\wedge\cdots\wedge dx^n,
  \end{equation}
  and we end up with the integral
  \begin{align}
    \int_{\cH^n} d\omega
    &= \sum_{j=1}^n (-1)^{j-1} \int_A\frac{\partial \omega^j}{\partial x^j}dx^1\wedge\cdots\wedge dx^n \\
    &= \sum_{j=1}^n (-1)^{j-1} \int_0^R\int_{-R}^R\cdots\int_{-R}^{R}\frac{\partial \omega^j}{\partial x^j}(x) dx^1\cdots dx^n.
  \end{align}
  The last are genuine euclidean integrals and we can change the order of integration in each term to always integrate the $x^j$ term first.
  The usual euclidean fundamental theorem of calculus then, for the terms with $i\neq n$, implies
  \begin{align}
    \int_{\cH^n} d\omega
    &= \sum_{j=1}^n (-1)^{j-1} \int_0^R\int_{-R}^R\cdots\int_{-R}^{R}\frac{\partial \omega^j}{\partial x^j}(x) dx^1\cdots dx^n \\
    &=\sum_{j=1}^n (-1)^{j-1} \int_0^R\int_{-R}^R\cdots\int_{-R}^{R}\frac{\partial \omega^j}{\partial x^j}(x) dx^j dx^1\cdots\widehat{dx^j}\cdots dx^n \\
    &=\sum_{j=1}^n (-1)^{j-1} \int_0^R\int_{-R}^R\cdots\int_{-R}^{R}\omega^j(x) \Big|_{x^i=-R}^{x^i=R} dx^1\cdots\widehat{dx^j}\cdots dx^n \\
    &= 0
  \end{align}
  since $R$ is larger than the support of $\omega$ at each coordinate.
  The only term that may not be zero is the $i=n$ one.
  In that case, for the same reasons,
  \begin{align}
    \int_{\cH^n} d\omega
    &=(-1)^{n-1} \int_{-R}^R\int_{-R}^R\cdots\int_{0}^{R}\frac{\partial \omega^n}{\partial x^j}(x) dx^n dx^1\cdots dx^{n-1} \\
    &=(-1)^{n-1} \int_{-R}^R\int_{-R}^R\cdots \omega^n(x)\Big|_{x^n=0}^{x^n=R} dx^n dx^1\cdots dx^{n-1} \\
    &=(-1)^{n-1} \int_{-R}^R\int_{-R}^R\cdots \omega^n(x^1, \ldots, x^{n-1}, 0) dx^1\cdots dx^{n-1}.\label{ex:lhsHn}
  \end{align}
  We now need to compare this with the right-hand side of~\eqref{eq:Stokes}.
  To this end, compute he following
  \begin{equation}
    \int_{\partial \cH^n}\omega = \sum_{j=1}^n \int_{A\cap\cH^n} \omega_j(x^1, \ldots, x^{n-1}, 0) dx^1 \wedge \cdots\wedge \widehat{dx}^j \wedge \cdots\wedge dx^n.
  \end{equation}
  Since $x^n$ vanishes on $\partial\cH^n$, the pullback of $dx^n$ to the boundary is zero, and thus the only surviving term in the sum is the last one, that is,
  \begin{equation}\label{eq:rhsHn}
    \int_{\partial \cH^n}\omega = \int_{A\cap\cH^n} \omega_n(x^1, \ldots, x^{n-1}, 0) dx^1 \wedge\cdots\wedge dx^{n-1}.
  \end{equation}
  Since coordinates $(x^1, \ldots, x^{n-1})$ are positively oriented for $\cH^n$ when $n$ is even and negatively oriented when $n$ is odd, we obtain the equality of \eqref{eq:lhsHn} and \eqref{eq:rhsHn}.

  \newthought{Part II: euclidean case}.
  If $M=\R^n$ the considerations above apply without the need to make an exception for the case $i=n$, so all the terms vanish on the left-hand side of~\eqref{eq:Stokes} while the right-hand side is trivially zero due to the empty boundary.

  \newthought{Part III: ``arbitrary'' $M$ but $\supp\omega$ is contained in a single chart}.
  Let $(U,\varphi)$ denote a chart such that $\supp \omega \subset U$.
  Without loss of generality assume that $\varphi$ is a positively oriented boundary chart, then
  \begin{align}
    \int_M d\omega
    &= \int_{\cH^n}(\phi^{-1})^* dw \\
    &= \int_{\cH^n} d\left((\phi^{-1})^* \omega\right) \\
    &\overset{(\spadesuit)}{=} \int_{\partial \cH^n}(\phi^{-1})^* w \\
    &= \int_{\partial M} w , 
  \end{align}
  where in the $(\spadesuit)$ step we applied the computations above and where $\partial \cH^n$ has the orientation induced by $\cH^n$.
  For a negatively oriented smooth boundary chart, the computation applies with an extra negative sign on each side of the equation.
  For an interior chart, we get the same computations with $\R^n$ in place of $\cH^n$.

  \newthought{Part IV: ``arbitrary'' $M$ and $\omega$}.
  Let finally $\omega\in\Omega^{n-1}(M)$ with compact support.
  Without loss of generality, let $\{(U_i, \varphi_i)\mid i\in I\}$ be a finite cover of $\supp \omega$ by positively oriented charts and $\{\rho_i\}$ a subordinate partition of unity with $\sum \rho_i(p) = 1$ for all $p\in\supp \omega$.
  For convenience, set $\omega_i := \rho_i\omega$.
  Then, by applying the previous arguments for each $i$ we get
  \begin{align}
    \int_{\partial M} \omega
    &= \sum_i \int_{\partial M} \omega_i 
     = \sum_i \int_M d(\rho_i \omega) \\
    &= \sum_i \int_M (d\rho_i \wedge\omega + \rho_i\, d\omega) \\
    &= \int_M d\left(\sum_i \rho_i\right)\wedge\omega + \int_M \left(\sum_i \rho_i\right) d\omega \\ 
    &= 0 + \int_M d\omega,
  \end{align}
  concluding the proof.
\end{proof}

\begin{example}
  Consider the annulus $M=\{(x,y)\in\R^2 \mid 1/2\leq x^2+y^2 \leq 1\}$ and the $1$-form $\omega = \frac{-y dx + x dy}{x^2 + y^2} = d\theta$ where $(x,y) = (\rho\cos\theta, \rho\sin\theta)$.
  
  Then $d\omega = 0$ and therefore $\int_M d\omega = 0$.
  Furthermore,
  \begin{align}
    \int_{\partial M}\omega
    &= \int_{x^2 + y^2 =1} \omega + \int_{x^2+y^2 =1/2}\omega \\ 
    &= \int_{0}^{2\pi} d\theta - \int_0^{2\pi}d \theta \\
    &= 2\pi - 2\pi = 0.
  \end{align}

  An important consequence of this is that while locally $\omega$ is the differential of the angle function $\theta$, this cannot be exact on all $M$: indeed, if $\omega = d\nu$, we would have
  \begin{equation}
    2\pi = \int_{\bS^1}\omega = \int_{\bS^1}d\nu = \int_{\partial\bS^1}\nu = 0.
  \end{equation}

  Moreover, since $2\pi = \int_{\bS^1}\omega$, Stokes' theorem also implies that $\bS^1$ is not the boundary of a compact regular domain in $\R^2\setminus\{0\}$.
\end{example}

In fact this example is a particular case of the following corollary of Stokes' theorem.

\begin{corollary}
  Suppose $M$ is a smooth manifolds with or without boundary,$S\subseteq M$ is an oriented compact smooth $k$-submanifold (without boundary) and $\omega$ is a closed $k$-form on $M$.
  If $\int_S\omega \neq 0$ then the following are true:
  \begin{enumerate}
    \item $\omega$ is not exact on $M$;
    \item $S$ is not the boundary of an oriented compact smooth submanifold with boundary in $M$.
  \end{enumerate}
\end{corollary}
\begin{exercise}
  Prove this corollary. \\
  \textit{\small Hint: look at the previous corollaries.}
\end{exercise}

\begin{exercise}
  Let $F:M\to N$ be a diffeomorphism between smooth manifolds and let $\omega\in\Omega^n(N)$ be compactly supported.
  Then,
  \begin{equation}
    \int_M F^*\omega = \int_N \omega.
  \end{equation}
\end{exercise}

\begin{corollary}
  Let $F:M\to M$ be a diffeomorphism and $\omega\in\Omega^n(M)$ an invariant volume form, that is, $F^*\omega =\omega$.
  Then, for all compactly supported smooth functions $f\in C^\infty_0(M)$, the following holds
  \begin{equation}
    \int_M f\omega = \int_M (f\circ F)\omega.
  \end{equation}
\end{corollary}
\begin{proof}
  Follows form the previous exercise by observing
  \begin{equation}
    F^*(f\omega) = (f\circ F) F^*\omega = (f\circ F)\omega.
  \end{equation}
\end{proof}

This corollary has deep consequences in classical mechanics, which I am going to teach in the master and you are welcome to attend!